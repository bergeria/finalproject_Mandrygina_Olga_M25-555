# бизнес-логика 

#Команды buy/sell доступны только для залогиненного пользователя.


Команда register
Назначение: создать нового пользователя.
Аргументы:
--username <str> — обязателен, не пустой, уникален.
--password <str> — обязателен, длина ≥ 4.
Шаги:
1.    Проверить уникальность username в users.json.
2.    Сгенерировать user_id (например, автоинкремент).
3.    Захешировать пароль (делайте односторонний псевдо-хеш (например, hashlib.sha256(password + salt)), соль храните рядом.).
4.    Сохранить пользователя в users.json.
5.    Создать пустой портфель (portfolios.json: user_id + пустой словарь кошельков).
6.    Вернуть сообщение об успехе.
 Пример:
> register --username alice --password 1234
Пользователь 'alice' зарегистрирован (id=3). Войдите: login --username alice --password **** 
Ошибки:
1) Username занят →
Имя пользователя 'alice' уже занято
2) Пароль слишком короткий →
Пароль должен быть не короче 4 символов  


Команда login
Назначение: войти и зафиксировать текущую сессию.
Аргументы:
--username <str> — обязателен.
--password <str> — обязателен.
Шаги:
1.    Найти пользователя по username.
2.    Сравнить хеш пароля.
Пример:
> login --username alice --password 1234
Вы вошли как 'alice' 
Ошибки:
1) Нет такого пользователя →
Пользователь 'alice' не найден
2) Неверный пароль →
Неверный пароль  


Команда show-portfolio
   Назначение: показать все кошельки и итоговую стоимость в базовой валюте (по умолчанию USD).
    Аргументы (необязательные):
   *    --base <str> — базовая валюта конвертации (по умолчанию USD).
    Шаги:
   1.    Убедиться, что пользователь залогинен.
   2.    Загрузить портфель пользователя.
   3.    Если кошельков нет — сообщить об этом.
   4.    Для каждого кошелька:
   *    показать currency_code, баланс;
   *    посчитать стоимость в base по текущим курсам;
   5.    Показать сумму по всем кошелькам в base.
    Пример:
    > show-portfolio
   Портфель пользователя 'alice' (база: USD):
   - USD: 150.00  → 150.00 USD
   - BTC: 0.0500  → 2965.00 USD
   - EUR: 200.00  → 214.00 USD
   ---------------------------------
   ИТОГО: 3,329.00 USD
     
   Ошибки:
   1) Не залогинен →
    Сначала выполните login
   2) Неизвестная базовая валюта →
    Неизвестная базовая валюта 'ABC'
     

def buy(): # Купить валюту
    pass

   Назначение: купить валюту.
   Аргументы:
   *    --currency <str> — код покупаемой валюты (например, BTC).
   *    --amount <float> — количество покупаемой валюты (в штуках, не в долларах).
   Шаги:
   1.    Проверить логин.
   2.    Валидировать currency (формат) и amount > 0.
   3.    Если в портфеле нет такого кошелька — автоматически создать (как делает add_currency).
   4.    Увеличить баланс кошелька на amount.
   5.    Опционально (по желанию) вести «расчётную стоимость» покупки для отчёта:
   *    Получить текущий курс currency → base.
   *    Посчитать стоимость amount * rate и вывести в итог.
    Пример:
    > buy --currency BTC --amount 0.05
    Покупка выполнена: 0.0500 BTC по курсу 59300.00 USD/BTC
   Изменения в портфеле:
   - BTC: было 0.0000 → стало 0.0500
   Оценочная стоимость покупки: 2,965.00 USD
     
   Ошибки:
   1) Некорректная сумма →
    'amount' должен быть положительным числом
   2) Не удалось получить курс →
    Не удалось получить курс для BTC→USD
     

def sell(): # Продать валюту - Команда sell
    pass


   Назначение: продать указанную валюту.
   Аргументы:
   *    --currency <str> — код валюты.
   *    --amount <float> — количество продаваемой валюты.
   Шаги:
   1.    Проверить логин.
   2.    Валидировать входные данные.
   3.    Проверить, что кошелёк существует и на нём достаточно средств.
   4.    Уменьшить баланс.
   5.    Опционально: начислить эквивалент в USD (если ведёте кошелёк USD).
    Пример:
    > sell --currency USD --amount 100
    Продажа выполнена: 0.0100 BTC по курсу 59800.00 USD/BTC
   Изменения в портфеле:
   - BTC: было 0.0500 → стало 0.0400
   Оценочная выручка: 598.00 USD
    
   Ошибки:
   1) Кошелёк не найден →
   У вас нет кошелька 'BTC'. Добавьте валюту: она создаётся автоматически при первой покупке.
   2) Недостаточно средств →
   Недостаточно средств: доступно 0.0400 BTC, требуется 0.0500 BTC
    

Команда get-rate
   Назначение: получить текущий курс одной валюты к другой.
   Аргументы:
   *    --from <str> — исходная валюта, напр. USD.
   *    --to <str> — целевая валюта, напр. BTC.
   Шаги:
   1.    Проверить валидность кодов валют (верхний регистр, не пустые).
   2.    Попробовать взять курс из локального кеша rates.json:
      *     Если курс свежий (например, моложе 5 минут) — показать его.
      *     Иначе — запросить у Parser Service (или использовать заглушку) → обновить кеш.
   3.    Показать курс и метку времени.
    Пример:
    > get-rate --from USD --to BTC
    Курс USD→BTC: 0.00001685 (обновлено: 2025-10-09 00:03:22)
    Обратный курс BTC→USD: 59337.21
    
   Ошибки:
   1) Нет данных и недоступен Parser →
   Курс USD→BTC недоступен. Повторите попытку позже.
    



